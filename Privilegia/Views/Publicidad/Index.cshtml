@using Privilegia.Helpers
@model IEnumerable<Privilegia.Models.PublicidadModel>
@{
    ViewBag.Title = "Publicidad";
}
<div class="row">
    <div class="col-md-12">
        <h2 align="center"><span class="glyphicon glyphicon-list"></span> Listado de Publicidad</h2>
        <hr />
    </div>
</div>
<div class="row">
    <div class="col-md-4">
        <label>Listado de Partners:</label>
        <select class="selectpicker" data-live-search="true" onchange="filterme()" multiple data-max-options="1" title="Selecciona un Partner...">
            @{
                if (ViewBag.listPartners != null)
                {
                    var lista = ViewBag.listPartners;

                    foreach (var partner in lista)
                    {
                        <option data-tokens="@partner.Nombre">@partner.Nombre</option>
                    }
                }
            }
        </select>
    </div>
    <div class="col-md-5 text-center">
    </div>
    <div class="col-md-3">
        <a class="btn btn-warning btn-block" href='@Url.Action("CalendarioPublicidad","Publicidad")'>Consultar Calendario <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span></a>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="table-responsive">
                <table id="Publicidad" class="table table-striped" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>Id</th>
                            <th>Nombre Empresa</th>
                            <th>Fecha de Inicio</th>
                            <th>Fecha de Fin</th>
                            <th>Soporte</th>
                            <th>Publicidad</th>
                            <th>Plan de Medios</th>
                            <th>Total</th>
                            <th>Factura</th>
                            <th>
                                <div class="pull-right">
                                    @Html.NoEncodeActionLink("<span class='glyphicon glyphicon-plus'></span>Nuevo", "Añadir Producto", "CreatePublicidad", "Publicidad", routeValues: null, htmlAttributes: new { @class = "btn btn-primary" })
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th colspan="7" style="text-align:right">Total:</th>
                            <th></th>
                        </tr>
                    </tfoot>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section scripts
{
    @Scripts.Render("~/scripts/AppJs/Privilegia.js")
    <script>

        var otable;

        $(function () {
            otable = $('#Publicidad')
                .dataTable({
                    "bServerSide": true,
                    "sAjaxSource": "Publicidad/CargarPublicidad",
                    "bProcessing": true,
                    "bAutoWidth": true,
                    "aoColumns": [
                        { "sName": "Id", "bVisible": false, "bSearchable": false },
                        { "sName": "Partner.Nombre" },
                        { "sName": "FechaInicio" },
                        { "sName": "FechaFin" },
                        { "sName": "NombreEspacioPublicidad" },
                        { "sName": "NombreParteEspacioPublicidad" },
                        {
                            "sName": "PlanDeMedios",
                            "render": function (data) {
                                if (data === "True") {
                                    return '<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>';
                                } else {
                                    return '<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>';
                                }
                            }
                        },
                        { "sName": "Total" },
                        { "sName": "idFactura", "bVisible": false, "bSearchable": false },
                        {
                            "mData": null,
                            "bSortable": false,
                            "render": function (data, type, row) {
                                var urlEditar = '@Url.Action("EditarPublicidad", "Publicidad")/' + row[0];
                                var urlBorrar = '@Url.Action("Detalles", "Publicidad")/' + row[0];
                                var urlVer = '@Url.Action("Detalles", "Publicidad")/' + row[0];

                                if (row[8] !== null) {
                                    //Tengo Factura
                                    var urlFactura = '@Url.Action("VerFacturaPublicidad", "Informes")/' + row[8];

                                    return '<a href=\"' + urlVer + '\" class=\"btn btn-info\"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></a> ' +
                                           '<a href=\"' + urlEditar + '\" class=\"btn btn-success\"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a> ' +
                                           '<a href=\"' + urlFactura + '\" class=\"btn btn-default\" target=\"_blank\"><span class="glyphicon glyphicon-file" aria-hidden="true"></span></a> ';
                                } else {
                                    //No tengo Factura


                                    return '<a href=\"' + urlVer + '\" class=\"btn btn-info \"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></a> ' +
                                           '<a href=\"' + urlEditar + '\" class=\"btn btn-success \"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a> ' +
                                           '<a href=\"' + urlBorrar + '\" class=\"btn btn-danger\"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></a> ';
                                }

                            }
                        }
                    ],
                    "footerCallback": function (row, data, start, end, display) {
                        var api = this.api(), data;

                        // Remove the formatting to get integer data for summation
                        var intVal = function (i) {
                            return typeof i === 'string' ?
                                i.replace(/[\$,]/g, '') * 1 :
                                typeof i === 'number' ?
                                i : 0;
                        };

                        // Total over all pages
                        var total = api
                            .column(7)
                            .data()
                            .reduce(function (a, b) {
                                return intVal(a) + intVal(b);
                            }, 0);
                        // Update footer
                        $(api.column(7).footer()).html(total + '€');
                    },
                    "oLanguage": {
                        "sProcessing": "Procesando...",
                        "sLengthMenu": "Mostrar _MENU_ registros",
                        "sZeroRecords": "No se encontraron productos.",
                        "sEmptyTable": "Ningún producto disponible.",
                        "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                        "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                        "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                        "sInfoPostFix": "",
                        "sSearch": "Buscar:",
                        "sUrl": "",
                        "sInfoThousands": ",",
                        "sLoadingRecords": "Cargando...",
                        "oPaginate": {
                            "sFirst": "Primero",
                            "sLast": "Último",
                            "sNext": "Siguiente",
                            "sPrevious": "Anterior"
                        },
                        "oAria": {
                            "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                            "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                        }
                    }
                }).yadcf([{
                    column_number: 6
                }]);

        });

        function filterme() {

            var partner = $('.selectpicker').val()[0];

            if (typeof partner !== "undefined") {
                otable.fnFilter(partner, 1);
            } else {
                partner = "";
                otable.fnFilter(partner, 1);
            }

        }

        $(document).ready(function () {


            console.log('@ViewBag.hola');
        });

    </script>


}


